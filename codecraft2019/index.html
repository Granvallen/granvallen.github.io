<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CodeCraft 2019 | Granvallen;Nest</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + 'bf1ecb4728a04112cb191bc2e62aa815';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CodeCraft 2019</h1><a id="logo" href="/.">Granvallen;Nest</a><p class="description">面白く生きる</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/about/"><i class="fa fa-terminal"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">CodeCraft 2019</h1><div class="post-meta">Jun 23, 2019<span> | </span><span class="category"><a href="/categories/Coding/">Coding</a><a href="/categories/Coding/C-C/">C/C++</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5,101</span><span class="post-meta-item-text"> 字</span></span></span><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E7%BB%86%E8%8A%82"><span class="toc-number">1.</span> <span class="toc-text">规则细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%BD%A6%E8%BE%86%E5%9C%A8%E8%B7%AF%E4%B8%8A%E8%A1%8C%E9%A9%B6%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">关于车辆在路上行驶的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%BD%A6%E8%BE%86%E5%9C%A8%E8%B7%AF%E5%8F%A3%E8%B0%83%E5%BA%A6%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">关于车辆在路口调度的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%BD%A6%E8%BE%86%E4%BB%8E%E8%B7%AF%E5%8F%A3%E8%BF%9B%E5%85%A5%E9%81%93%E8%B7%AF"><span class="toc-number">1.3.</span> <span class="toc-text">关于车辆从路口进入道路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%AD%BB%E9%94%81"><span class="toc-number">1.4.</span> <span class="toc-text">关于死锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q-amp-A"><span class="toc-number">1.5.</span> <span class="toc-text">Q&amp;A</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%A4%A7%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="toc-number">3.</span> <span class="toc-text">程序大体框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">4.</span> <span class="toc-text">最后</span></a></li></ol></div></div><div class="post-content"><p>又是一篇拖了好长时间的文章…</p>
<p>CodeCraft是华为2015年起开始举办的编程挑战赛, 强调享受用coding解决问题的乐趣. 其实那段时间(两个月前)有好几个华为组织的比赛什么销售, 云计算等等. 我因为之前都没参加过, 加之感觉coding会好玩一些所以报名了CodeCraft. 虽然最后完成了程序但没及时上传（；´д｀）ゞ, 嗯, 从结果来说好像连炮灰也没当成?</p>
<span id="more"></span>
<p>题目在<a target="_blank" rel="noopener" href="https://codecraft.huawei.com/">这里</a>, 简单来说就是车辆调度的问题, 官方给出car.txt, road.txt和cross.txt三个文件即车, 路和路口信息, 根据简化后的交通规则, 你的程序需要输出每辆车的上路时间以及行驶路线. 拿到题目首先就必须研究下这个设定的交通规则, 其中涉及到不少细节问题, 大体规则可以参考官方文档, 以下是一些当时有疑问的细节和官方解答.</p>
<h1 id="规则细节"><a href="#规则细节" class="headerlink" title="规则细节"></a>规则细节</h1><h2 id="关于车辆在路上行驶的规则"><a href="#关于车辆在路上行驶的规则" class="headerlink" title="关于车辆在路上行驶的规则"></a>关于车辆在路上行驶的规则</h2><blockquote>
<p>车辆如果行驶过程中, 发现前方有车辆阻挡, 且阻挡的车辆为终止车辆, 则该辆车也被标记为终止车辆. （与前方阻挡的车辆的距离记为s）则该车辆最大行驶速度为v = min(最高车速, 道路限速, s/t) 其中t=1, 该车辆最大可行驶距离为s. </p>
</blockquote>
<p>这里官方文档第二句话少了”否”字, 应为</p>
<blockquote>
<p>否则该车辆最大行驶速度为v = min(最高车速, 道路限速, s/t) 其中t=1, 该车辆最大可行驶距离为s. </p>
</blockquote>
<p>也就是说当有前车开得比较慢时, 该车也要降低速度. 而第一句是说如果前车停了, 则该车立即停止. <strong>因此, 每辆车的速度每次轮到时都要根据前车情况重新计算. </strong> 另外如果前车是等待调度状态, 那么该车也是等待状态.</p>
<p>下面是官方给出的例子:</p>
<blockquote>
<p>假定道路有如下车辆, 车AB车速为3, CD均为车速为1<br><strong>A空空B空空CD （路口）</strong></p>
<p>按步骤一后ABCD均为等待状态. </p>
<p>在处理待状态车辆D后, 假定D前进到其他道路后, 此刻道路状态变化为</p>
<p><strong>A空空B空空C空   （路口）</strong></p>
<p><strong>接下来因D车辆的前进后, 需要对该条道路该车道的所有车辆进行一次调度</strong></p>
<p>因此:</p>
<p>C的车速为1, 则C车前进1个距离, 且为终止状态. <strong>A空空B空空空C   （路口）</strong></p>
<p>B的车速为3, 则B车前进3个距离, 且为终止状态. <strong>A空空空空空BC   （路口）</strong></p>
<p>A的车速为3, 则A车前进3个距离, 且为终止状态. <strong>空空空A空空BC   （路口）</strong></p>
<p><strong>调度后道路车辆分布为: 空空空A空空BC   （路口）, 且ABC均为终止状态</strong></p>
</blockquote>
<h2 id="关于车辆在路口调度的规则"><a href="#关于车辆在路口调度的规则" class="headerlink" title="关于车辆在路口调度的规则"></a>关于车辆在路口调度的规则</h2><p>例子如下图:</p>
<p><img src="https://raw.githubusercontent.com/Granvallen/granvallen.github.io/master/img/cross.png" style="zoom:67%;" /></p>
<blockquote>
<p>在本路口调度道路的顺序为</p>
<p>5000、5001、5010、5018、5000、5001、5010、5018、5000、5001、5010、5018…5000、5001、5010、5018</p>
<p>整个系统调度按路口ID升序进行调度各个路口, 路口内各道路按道路ID升序进行调度. </p>
</blockquote>
<p>也就是说, <strong>路口调度顺序与各道路的调度顺序是固定的.</strong></p>
<blockquote>
<p>首先调度5000道路, 只有D100可以走, 因为D101左转与5010道路的D200冲突, 所以必须等待5010车道上没有直行冲突. </p>
</blockquote>
<p>这里的<code>D101</code>官方又写错了, 应该是<code>L101</code>, 该车是当前5000道路优先级最高的车, 但与5010最高优先级直行的车<code>D200</code>冲突(都要到5018道路), 直行的优先级更高, 故对5000道路的调度先搁下了(当道路最高优先级的车停下, 其他车也不能动). </p>
<p><strong>因此, 当对路口的一条道路调度时, 首先看这条道路优先级最高的车, 若不与其他道路最高优先级的车冲突, 则立即行驶, 然后看该道路第二优先级的车. 如果有冲突, 则调度下一条道路.</strong></p>
<blockquote>
<p>其次再调度5001道路, 因5001道路的L300与道路5018的D400冲突, 所以L300必须等待道路5018的D400先行后再调度行驶. </p>
<p>再次调度道路5010, D200、D201、D202不与其他道路的车辆冲突, 可以直接行驶. L203左转, 且道路5001无左转车辆与其冲突, 因此L203可以左转. L204也可以左转. L205为右转, 与左侧道路5000的车辆L101不冲突（只与道路5000的直行会发生冲突）, 且与道路5018的D400不发生冲突（只与道路5018的左转车辆发生冲突）, 因此车辆L205可以右转, 依次道路5010上的剩余车辆全部可以通过. </p>
</blockquote>
<p>在道路通畅的条件下(驶入道路没有限制), 路口调度应该是这样的:</p>
<ul>
<li>当调度一辆车是直行的时候一定可以立即直行</li>
<li>当调度一辆车左转时, 只需要看右边道路最高优先级的车是否直行</li>
<li>当调度一辆车右转时, 需要看左边道路优先级最高的车是否直行以及对面车道优先级最高的车是否左转</li>
</ul>
<p>在实际情况时还要考虑车驶入车道的情况, 比如驶入车道是拥堵的, 此时该车的调度也只能先搁下.</p>
<blockquote>
<p>接着调度5018道路上的车辆…..</p>
<p>再调度道路5000….</p>
<p>再调度道路5001…</p>
<p>再调度道路5000….</p>
<p>是否发生冲突, 只与相关道路的第一优先级车辆的行驶方向进行比较, 看是否发生冲突. </p>
<p>每次调度到一条道路, 直到该道路无车辆可调度, 或该条道路上车辆处于冲突状态. 也就是说尽可能多地让该道路行驶, 直到没有车辆或者车辆与其他车辆发生冲突不可行驶. </p>
</blockquote>
<h2 id="关于车辆从路口进入道路"><a href="#关于车辆从路口进入道路" class="headerlink" title="关于车辆从路口进入道路"></a>关于车辆从路口进入道路</h2><p><img src="https://raw.githubusercontent.com/Granvallen/granvallen.github.io/master/img/enterroad.png" style="zoom: 80%;" /></p>
<p>这里要注意的是<strong>发车顺序</strong>, 先是100-&gt;200-&gt;300, 然后101-&gt;201-&gt;301. 这里200比101更靠近路口, 尽管101在1号道, 200在2号道, 依然是200先行. 这一点在上面的路口冲突判断的图里也有体现, 当<code>D101</code>走后是判断<code>L101</code>, 而不是<code>L103</code></p>
<h2 id="关于死锁"><a href="#关于死锁" class="headerlink" title="关于死锁"></a>关于死锁</h2><blockquote>
<p>基于10, <strong>参赛选手需要注意</strong>, 一次调度能使所有车辆均到达各车辆的行驶速度行驶, 就得保证不能出现各车辆循环等待的情况, 否则该次调度就会<strong>锁死</strong>. 循环等待是指比如车辆A等待车辆B, 车辆B等待车辆C, 车辆C等待车辆D, 车辆D等待车辆E, 车辆E等待车辆F, 车辆F等待车辆A的情况. </p>
</blockquote>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>问: 如果一个路口的所有道路的车都冲突不动了, 怎么办? 是直接结束该路口的调度? 这样的话如果下一路口调度了导致上一路口可以再进行调度, 还需要对上一路口进行调度吗? 如果不进行调度那么路口的调度顺序对结果影响很大?</p>
<p>答: 是的, 会对上一路口再次进行调度(会进行下一次路口的调度循环), 只要有一个路口还需要调度, 就会再进行一次调度所有路口的循环</p>
<p>问: 每辆车都有出发时间的限定, 但是规则中出现<code>实际出发时间</code>的说法, 那么是程序可以调节车的实际出发时间吗? 还是只能是因为道路堵塞推迟出发时间?</p>
<p>答: 车辆的实际出发时间由参赛选手自行决定, 但是不得早于车辆的计划出发时间</p>
<p>问: 起步车辆放置于车道的位置确定问题?</p>
<p>答: 进入道路依然按车道小的优先策略进行</p>
<p>问: 那么起步车辆与路口调度时的车辆比, 优先级如何?</p>
<p>答: 系统调度先调度在路上行驶的车辆进行行驶, 当道路上所有车辆全部不可再行驶后再调度等待上路行驶的车辆</p>
<p>问: 多辆车同地点同时发车?</p>
<p>答: 交通规则有说明, 同一时刻多辆车上路行驶, 按车辆编号升序进行优先上路</p>
<p>其他: </p>
<blockquote>
<p>整个系统限制参赛选手程序编译时间最大为60s, 程序运行生成answer.txt时间为300s. </p>
<p>车辆的长度为1(占一格), 行驶速度的含义是一个时间单位内前进的格数</p>
</blockquote>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>整个系统要调度的只有车, 更确切点说是车的两个值: <strong>实际出发时间</strong>和<strong>车在每个路口选择的行驶方向</strong>, 除此之外都由规则定死了. 也就说只要确定了每辆车的这两个值, 那么最后的结果就是确定的, 不存在任何的随机性.</p>
<p>总的来说, 解决这个问题的想法大概有两个吧.</p>
<p>其一直接最优化, 系统根据输入和规则直接给出最优的调度方案. 因为本质上说这是一个最优化问题. 但我还是怀疑有没有这种解法, 题目设定的规则还是过于复杂, 于是没有做这方面的尝试, 而偏向于使用模拟或尝试性的解决办法.</p>
<p>退而求其次可以逐步最优, 系统首先对输入进行模拟, <strong>在每个时间片上(只考虑当前时刻)进行最优调度</strong>, 但每个时间片上的最优策略就结果来说并不能保证是最优的. 不过即使简化到这样可能对我来说实现还是比较困难. 不怕, 大不了在逐步最优的基础上, 再进行简化嘛, 比如变成在<strong>每个时间片上对每辆车单独进行最优调度</strong>. 还不够, 因为这个系统中的车的行驶过程不是独立的, 可能会相互影响, 因此即使单独考虑每一辆车的最优可能也是困难的, 所以只能是<strong>尽可能地靠近最优调度</strong>.</p>
<p>综上, 目前考虑的方法是建立在模拟运行的基础上, <strong>每一个时间片对每辆车单独地做出尽可能接近最优的调度</strong>. 这个方法可能比较好的一点是策略是动态的, 可以根据模拟运行时的情况对调度进行调整, 而这个调整(如何尽可能接近最优)也可以有发挥的余地.</p>
<p>以上讨论的都是车在路口的行驶方向的选择问题, 还有一部分是车实际出发时间的确定问题, 时间比较紧就没怎么考虑过. 总之现阶段考虑车能出发则出发, 不能出发则等到能出发为止. 当然一个理想的系统可能会故意延长车的实际出发时间(能出发不出发), 以达到系统更优.</p>
<p>要解决这个问题路径规划(Pathfinding)算法是必不可少的, 用于实际在每个路口确定行驶方向. 这方面优先考虑的是启发式路径搜索的A*, 在<a target="_blank" rel="noopener" href="http://theory.stanford.edu/~amitp/GameProgramming/">Amit’s A* Pages</a>有比较详细的介绍和生动的例子, 同时也参考了部分将启发性路径搜索算法应用于实际导航路径规划的文献. 正当要动手开始写的时候发现了一个致命的问题—比赛给的地图不保证是物理可实现的. 启发式路径搜索不同于传统路径搜索的地方在于在计算路径cost的时候多了一个启发函数项(heuristic function), 因此路径搜索受启发函数影响优先往函数值小的方向搜索. 这类方法的主要问题在于如何选择这个启发函数, 选择的好坏最终将影响路径搜索的效率, 这也是为什么这个名字这么玄乎的原因. 通常采用欧式距离(平面坐标)和曼哈顿距离(网格坐标)作为启发函数, 这通常来说是合理的, 但都要求知道每个节点确切的坐标信息, 而赛题中只是知道节点与边的关系, 需要自己去构建一个位置关系, 由于是非实际可实现的道路, 先不说能不能构建或容不容易构建, 即使构建出来, 要设计一个符合的启发函数也不容易. というわけで, 最后还是采用了Dijkstra算法(摊手), 顺带稍稍优化了权重计算.</p>
<h1 id="程序大体框架"><a href="#程序大体框架" class="headerlink" title="程序大体框架"></a>程序大体框架</h1><ul>
<li>car.hpp实现了Car与CarList两个类, 用于封装车辆信息</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Car</span>() &#123;&#125; <span class="comment">// 为什么没有默认构造函数会报错</span></span><br><span class="line">	<span class="built_in">Car</span>(<span class="type">long</span> id, <span class="type">long</span> from, <span class="type">long</span> to, <span class="type">int</span> speed, <span class="type">long</span> planTime):</span><br><span class="line">		<span class="built_in">id</span>(id), <span class="built_in">from_id</span>(from), <span class="built_in">to_id</span>(to), <span class="built_in">max_speed</span>(speed), </span><br><span class="line">		<span class="built_in">plan_time</span>(planTime), <span class="built_in">next_cross</span>(from), <span class="built_in">isSetoff</span>(<span class="literal">false</span>), <span class="built_in">isStoped</span>(<span class="literal">false</span>) &#123;&#125;</span><br><span class="line">	<span class="built_in">Car</span>(<span class="type">long</span>* carinfo)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (carinfo)</span><br><span class="line">		&#123;</span><br><span class="line">			id = carinfo[<span class="number">0</span>];</span><br><span class="line">			from_id = next_cross = carinfo[<span class="number">1</span>];</span><br><span class="line">			to_id = carinfo[<span class="number">2</span>];</span><br><span class="line">			max_speed = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(carinfo[<span class="number">3</span>]);</span><br><span class="line">			plan_time = carinfo[<span class="number">4</span>];</span><br><span class="line">			isSetoff = isStoped = <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">showRoute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> ostream &amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, Car &amp;car);</span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> id; <span class="comment">// 车的id</span></span><br><span class="line">	<span class="type">long</span> from_id; <span class="comment">// 起始路口id</span></span><br><span class="line">	<span class="type">long</span> to_id; <span class="comment">// 终点路口id</span></span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> max_speed; <span class="comment">// 最大车速</span></span><br><span class="line">	<span class="type">int</span> curr_speed; <span class="comment">// 当前车速  这个变量到目前为止好像没起什么作用 可能到考虑实时路况时才能起参考</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 车在一条路上的坐标 如一条长为4的路坐标为 1 2 3 4</span></span><br><span class="line">	<span class="comment">// 这个值在车进入道路时初始化 行进过程中更新</span></span><br><span class="line">	<span class="type">int</span> pos;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSetoff; <span class="comment">// 是否已出发</span></span><br><span class="line">	<span class="type">long</span> plan_time; <span class="comment">// 原计划出发时间</span></span><br><span class="line">	<span class="type">long</span> real_time; <span class="comment">// 实际出发时间</span></span><br><span class="line">	<span class="type">long</span> dally_time; <span class="comment">// 已延迟的时间</span></span><br><span class="line"></span><br><span class="line">	list&lt;<span class="type">long</span>&gt; route_plan; <span class="comment">// 计划路线经过的路口id 不包括已经走过的路口 虽然答案里要求是行驶道路的id</span></span><br><span class="line">	list&lt;<span class="type">long</span>&gt; route_real; <span class="comment">// 实际行驶经过路口id</span></span><br><span class="line">	<span class="type">int</span> next_turn; <span class="comment">// 下一个路口转弯方向 0-上 1-右 2-下 3-</span></span><br><span class="line">	<span class="type">long</span> next_road; <span class="comment">// 下一条行驶的道路id 行驶到路口更新</span></span><br><span class="line">	<span class="type">long</span> next_cross; <span class="comment">// 下一个路口id</span></span><br><span class="line">	<span class="type">int</span> lane_num; <span class="comment">// 所行驶的车道号 车在上路时更新</span></span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isStoped; <span class="comment">// 是否停车</span></span><br><span class="line">	<span class="type">bool</span> isScheduled; <span class="comment">// 是否在当前时间片段经过调度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CarList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CarList</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">CarList</span>(string carfile) &#123; <span class="built_in">initCarList</span>(carfile); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">initCarList</span><span class="params">(string carfile)</span></span>;</span><br><span class="line">	Car&amp; <span class="keyword">operator</span>[](<span class="type">long</span> i) &#123; <span class="keyword">return</span> carlist[i]; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Car&amp; car)</span> </span>&#123; carlist[car.id] = car; &#125; <span class="comment">// unordered_map这里[]实现深复制</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">long</span> id)</span> </span>&#123; carlist.<span class="built_in">erase</span>(id); &#125;</span><br><span class="line">	<span class="function"><span class="type">const</span> unordered_map&lt;<span class="type">long</span>, Car&gt;&amp; <span class="title">getList</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> carlist; &#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> carlist.<span class="built_in">empty</span>(); &#125;</span><br><span class="line">	<span class="function"><span class="type">long</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> carlist.<span class="built_in">size</span>(); &#125;</span><br><span class="line"></span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, Car&gt;::<span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> carlist.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, Car&gt;::<span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> carlist.<span class="built_in">end</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, Car&gt; carlist;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>road.hpp实现了Road与RoadList两个类, 用于封装道路信息</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Road</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Road</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">Road</span>(<span class="type">long</span>* roadinfo)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (roadinfo)</span><br><span class="line">		&#123;</span><br><span class="line">			id = roadinfo[<span class="number">0</span>];</span><br><span class="line">			length = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(roadinfo[<span class="number">1</span>]);</span><br><span class="line">			max_speed = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(roadinfo[<span class="number">2</span>]);</span><br><span class="line">			channel = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(roadinfo[<span class="number">3</span>]);</span><br><span class="line">			from_id = roadinfo[<span class="number">4</span>];</span><br><span class="line">			to_id = roadinfo[<span class="number">5</span>];</span><br><span class="line">			isDuplex = roadinfo[<span class="number">6</span>] &gt; <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">			road_from_to.<span class="built_in">resize</span>(channel);</span><br><span class="line">			<span class="keyword">if</span> (isDuplex)</span><br><span class="line">				road_to_from.<span class="built_in">resize</span>(channel);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> ostream &amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, Road &amp;road);</span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> id;</span><br><span class="line">	<span class="type">int</span> length; <span class="comment">// 路长</span></span><br><span class="line">	<span class="type">int</span> max_speed; <span class="comment">// 最大车速</span></span><br><span class="line">	<span class="type">int</span> channel; <span class="comment">// 车道数</span></span><br><span class="line">	<span class="type">long</span> from_id; <span class="comment">// 起始路口id</span></span><br><span class="line">	<span class="type">long</span> to_id; <span class="comment">// 终点路口id</span></span><br><span class="line">	<span class="type">bool</span> isDuplex; <span class="comment">// 是否双向</span></span><br><span class="line">	</span><br><span class="line">	<span class="type">bool</span> isBlock; <span class="comment">// 是否堵路</span></span><br><span class="line"></span><br><span class="line">	<span class="function">vector&lt;Lane&gt;&amp; <span class="title">getRoadCars</span><span class="params">(<span class="type">long</span> to)</span></span>; <span class="comment">// 返回一个方向的所有车道</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getCarsNum</span><span class="params">(<span class="type">long</span> crossid)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">isTo</span><span class="params">(<span class="type">long</span> crossid)</span> </span>&#123; <span class="keyword">return</span> crossid == to_id || (crossid == from_id &amp;&amp; isDuplex); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	vector&lt;Lane&gt; road_from_to; <span class="comment">// 记录从from节点到to节点 各个channel行驶车的队列 存车的id</span></span><br><span class="line">	vector&lt;Lane&gt; road_to_from; <span class="comment">// 如果是单行线的话这个vector是空的</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RoadList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">RoadList</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">RoadList</span>(string roadfile) &#123; <span class="built_in">initRoadList</span>(roadfile); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">initRoadList</span><span class="params">(string roadfile)</span></span>;</span><br><span class="line">	Road &amp; <span class="keyword">operator</span>[](<span class="type">long</span> i) &#123; <span class="keyword">return</span> roadlist[i]; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Road&amp; road)</span> </span>&#123; roadlist[road.id] = road; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">long</span> id)</span> </span>&#123; roadlist.<span class="built_in">erase</span>(id); &#125;</span><br><span class="line">	<span class="function"><span class="type">const</span> map&lt;<span class="type">long</span>, Road&gt;&amp; <span class="title">getList</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> roadlist; &#125;</span><br><span class="line"></span><br><span class="line">	map&lt;<span class="type">long</span>, Road&gt;::<span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> roadlist.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">	map&lt;<span class="type">long</span>, Road&gt;::<span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> roadlist.<span class="built_in">end</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	map&lt;<span class="type">long</span>, Road&gt; roadlist;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>cross.hpp实现了Cross与CrossList两个类, 用于封装路口信息</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cross</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Cross</span>() &#123;&#125;</span><br><span class="line">	<span class="comment">//Cross(long id, long road0, long road1, long road2, long road3) : id(id)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	road_id[road0] = 0; road_id[road1] = 1;</span></span><br><span class="line">	<span class="comment">//	road_id[road2] = 2; road_id[road3] = 3;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="built_in">Cross</span>(<span class="type">long</span>* crossinfo)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (crossinfo)</span><br><span class="line">		&#123;</span><br><span class="line">			id = crossinfo[<span class="number">0</span>];</span><br><span class="line">			<span class="comment">// 注意这里没路的 -1 也会放进去 把序号作为键 路id为值</span></span><br><span class="line">			road_id[<span class="number">0</span>] = crossinfo[<span class="number">1</span>]; road_id[<span class="number">1</span>] = crossinfo[<span class="number">2</span>];</span><br><span class="line">			road_id[<span class="number">2</span>] = crossinfo[<span class="number">3</span>]; road_id[<span class="number">3</span>] = crossinfo[<span class="number">4</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> ostream &amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, Cross &amp;cross);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 由路序号得到路id</span></span><br><span class="line">	<span class="function"><span class="type">long</span> <span class="title">getRoadIdx</span><span class="params">(<span class="type">int</span> roadid)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i : road_id)</span><br><span class="line">			<span class="keyword">if</span> (i.second == roadid)</span><br><span class="line">				<span class="keyword">return</span> i.first;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> id; <span class="comment">// 路口id</span></span><br><span class="line">	map&lt;<span class="type">long</span>, <span class="type">int</span>&gt; road_id; <span class="comment">// 四个连接道路的id 没路的为-1 用map可以实现路id升序</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//int road_num; // 连接道路数目</span></span><br><span class="line">	<span class="type">bool</span> isBlock; <span class="comment">// 是否堵塞</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CrossList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CrossList</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">CrossList</span>(string crossfile) &#123; <span class="built_in">initCrossList</span>(crossfile); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">initCrossList</span><span class="params">(string crossfile)</span></span>;</span><br><span class="line">	Cross &amp; <span class="keyword">operator</span>[](<span class="type">long</span> i) &#123; <span class="keyword">return</span> crosslist[i]; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Cross&amp; cross)</span> </span>&#123; crosslist[cross.id] = cross; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">long</span> id)</span> </span>&#123; crosslist.<span class="built_in">erase</span>(id); &#125;</span><br><span class="line">	<span class="function"><span class="type">const</span> map&lt;<span class="type">long</span>, Cross&gt;&amp; <span class="title">getList</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> crosslist; &#125;</span><br><span class="line"></span><br><span class="line">	map&lt;<span class="type">long</span>, Cross&gt;::<span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> crosslist.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">	map&lt;<span class="type">long</span>, Cross&gt;::<span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> crosslist.<span class="built_in">end</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	map&lt;<span class="type">long</span>, Cross&gt; crosslist; <span class="comment">// 由于之后cross要按id从小到大遍历 所以用有序map</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>RoadGraph.hpp实现RoadGraph类, 负责整合道路与路口构建图网络, 并且实现路径规划算法</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RoadGraph</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">RoadGraph</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">RoadGraph</span>(CrossList&amp; crosslist, RoadList&amp; roadlist) &#123; <span class="built_in">initGraph</span>(crosslist, roadlist); &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 初始化路线图 neighborsOf 与 distBetween 便于之后搜索路径</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">initGraph</span><span class="params">(CrossList&amp; crosslist, RoadList&amp; roadlist)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">findFastestRoute</span><span class="params">(CrossList&amp; crosslist, RoadList&amp; roadlist, Car&amp; car)</span></span>;</span><br><span class="line"></span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, list&lt;<span class="type">long</span>&gt; &gt; neighborsOf; <span class="comment">// 一个节点的相邻节点</span></span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, unordered_map&lt;<span class="type">long</span>, <span class="type">double</span>&gt; &gt; distBetween; <span class="comment">// 所有相邻节点的距离</span></span><br><span class="line">	unordered_map&lt;<span class="type">long</span>, unordered_map&lt;<span class="type">long</span>, <span class="type">long</span>&gt; &gt; roadBetween; <span class="comment">// 所有相邻节点之间路的id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dijkstra_search</span><span class="params">(CrossList&amp; crosslist, RoadList&amp; roadlist, Car&amp; car)</span></span>; <span class="comment">// dijkstra路径搜索方法</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>Scheduler.hpp实现了一个调度器</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Scheduler</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Scheduler</span>(string cartxt, string roadtxt, string crosstxt): <span class="built_in">time</span>(<span class="number">0</span>), <span class="built_in">isDone</span>(<span class="literal">false</span>) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">initScheduler</span>(cartxt, roadtxt, crosstxt);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> time; <span class="comment">// 调度时间</span></span><br><span class="line">	<span class="type">bool</span> isDone; <span class="comment">//是否调度完成</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">step</span><span class="params">()</span></span>; <span class="comment">// 走一个时间片段</span></span><br><span class="line"></span><br><span class="line">	CarList carwaitgo; <span class="comment">// 等待上路的车</span></span><br><span class="line">	CarList carsetoff; <span class="comment">// 在路上的车</span></span><br><span class="line">	RoadList roadlist;</span><br><span class="line">	CrossList crosslist;</span><br><span class="line">	RoadGraph roadgraph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">initScheduler</span><span class="params">(string cartxt, string roadtxt, string crosstxt)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">scheduleCarwaitgo</span><span class="params">()</span></span>; <span class="comment">// 调度等待上路的车</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">scheduleInit</span><span class="params">()</span></span>; <span class="comment">// 每次调度前准备</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">scheduleRoad</span><span class="params">()</span></span>; <span class="comment">// 调度每一条道路</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">scheduleLane</span><span class="params">(Road&amp; road, Lane&amp; lane)</span></span>; <span class="comment">// 调度路一个方向上的所有车道</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">scheduleCross</span><span class="params">()</span></span>; <span class="comment">// 调度所有路口</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">scheduleCrossRoad</span><span class="params">(Cross&amp; cross)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">enterRoad</span><span class="params">(Car&amp; car, Lane&amp; lane, <span class="type">int</span> lane_num, <span class="type">int</span> speed)</span></span>; <span class="comment">// 车进入道路</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">leaveRoad</span><span class="params">(Car&amp; car, Lane&amp; lane)</span></span>; <span class="comment">// 车离开道路</span></span><br><span class="line">	<span class="function"><span class="type">long</span> <span class="title">getfirstCar</span><span class="params">(Road&amp; road, Cross&amp; to)</span></span>; <span class="comment">// 返回一个方向的车道中最先调度的车</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">tryEnterRoad</span><span class="params">(Cross&amp; cross, Road&amp; road, Car&amp; car)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">answer</span><span class="params">(Car&amp; car)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">showstatus</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> flag1; <span class="comment">// 记录遍历 所有cross 的一个循环中 是否发生了调度 如果调度再进行一次这个循环</span></span><br><span class="line">	<span class="type">bool</span> flag2; <span class="comment">// 记录遍历 一个cross所有路 的循环中 是否发生了调度</span></span><br><span class="line">	<span class="type">bool</span> flag3; <span class="comment">// 记录遍历一个cross所有路的循环中 是否发生了调度 如果调度再进行一次这个循环 直到没有调度</span></span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> carnum = <span class="number">0</span>;</span><br><span class="line">	<span class="type">long</span> donenum = <span class="number">0</span>;</span><br><span class="line">	<span class="type">long</span> carwaitgonum = <span class="number">0</span>;</span><br><span class="line">	<span class="type">long</span> carsetoffnum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>main</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Scheduler <span class="title">scheduler</span><span class="params">(<span class="string">&quot;car.txt&quot;</span>, <span class="string">&quot;road.txt&quot;</span>, <span class="string">&quot;cross.txt&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!scheduler.isDone)</span><br><span class="line">		scheduler.<span class="built_in">step</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><ul>
<li>由于没有成功在赛方的服务器上跑过, 所以到底效果如何有没有其他问题都尚不明确, 虽然线下测试结果勉强还行, 也没碰到死锁的情况. 当然为了鲁棒性加个死锁判定还是有必要的.</li>
<li>由于比赛期间一直有其他事, 所以前后参赛了不到5天的时间. 后来看获奖者感言, 原来大家都一样, 都是在搬砖期间抽空做的, 白天搬砖, 晚上调程序…</li>
<li>全程玩得还是挺开心的, 嗯, 希望下次能做一个合格的炮灰(认真脸).</li>
</ul>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>終わり</p>
</div><div class="tags"><a href="/tags/C-C/"><i class="fa fa-tag"></i>C/C++</a><a href="/tags/CodeCraft/"><i class="fa fa-tag"></i>CodeCraft</a></div><div class="post-nav"><a class="pre" href="/lightoutgame/">点灯游戏与数学之美</a><a class="next" href="/xingyouji/">从《星游记》出发聊聊所见所想</a></div><div id="tcomment"></div><script src="https://s4.zstatic.net/ajax/libs/twikoo/1.6.10/twikoo.all.min.js"></script><script>twikoo.init({
  envId: 'https://granvallen.vercel.app',
  el: '#tcomment',
  region: '',
  path: ''
})</script></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Granvallen.</a> <br /> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>